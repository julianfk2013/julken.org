<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Galactic Assault â€” Classic Space Shooter</title>
  <link rel="icon" type="image/png" sizes="16x16" href="../../favicon_16x16.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="../../favicon_32x32.png" />
  <link rel="icon" type="image/png" sizes="256x256" href="../../favicon_256x256.png" />
  <link rel="stylesheet" href="breakout.css?v=13" />
</head>
<body>
  <a class="homeBtn" href="../../index.html">ğŸ  Home</a>

  
  <div class="hud">
    <div class="hud-item">
      <span class="hud-label">Score:</span>
      <span class="hud-value" id="score">0</span>
    </div>
    <div class="hud-item">
      <span class="hud-label">Level:</span>
      <span class="hud-value" id="level">1</span>
    </div>
    <div class="hud-item">
      <span class="hud-label">Lives:</span>
      <span class="hud-value" id="lives">â¤ï¸â¤ï¸â¤ï¸</span>
    </div>
    <div class="hud-item">
      <span class="hud-label">Combo:</span>
      <span class="hud-value" id="combo">1.0x</span>
    </div>
    <div class="hud-item">
      <span class="hud-label">Coins:</span>
      <span class="hud-value" id="coins">0</span>
    </div>
    <div class="hud-item">
      <button id="muteBtn" class="mute-btn" title="Toggle Music">ğŸ”Š</button>
    </div>
  </div>

  
  <div id="activePowerups"></div>

  
  <!-- Mobile touch controls -->
  <div id="mobileControls" style="display: none;">
    <!-- Joystick on left side -->
    <div id="joystickContainer">
      <div id="joystickBase">
        <div id="joystickKnob"></div>
      </div>
    </div>
    <!-- Shoot button on right side -->
    <button id="shootBtn">ğŸ”«</button>
  </div>

  <!-- Portrait orientation hint for mobile users in landscape -->
  <div id="portraitHint">
    <div class="portrait-hint-content">
      <span class="portrait-hint-icon">ğŸ“±</span>
      <span class="portrait-hint-text">Rotate to portrait mode for best experience</span>
      <button id="portraitHintDismiss" class="portrait-hint-btn">Got it</button>
    </div>
  </div>

  
  <div id="gameContainer">
    <canvas id="gameCanvas"></canvas>
  </div>

  <div id="overlay">
    <div id="menuContent"></div>
  </div>

  
  <script src="js/config.js?v=3"></script>
  <script src="js/storage.js"></script>
  <script src="js/engine.js?v=3"></script>
  <script src="js/galacticassault-assets.js"></script>
  <script src="js/galacticassault-background.js?v=2"></script>
  <script src="js/galacticassault-entities.js?v=2"></script>
  
  <script src="js/ui.js"></script>
  <script src="js/galacticassault-game.js?v=14"></script>

  
  <script>

    window.addEventListener('DOMContentLoaded', () => {
      console.log('ğŸš€ Galactic Assault - Initializing...');

      // Mobile Debug System
      const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
      const debugPanel = document.getElementById('mobileDebug');
      const debugLog = document.getElementById('debugLog');
      let debugMessages = [];

      function mobileLog(msg) {
        const time = new Date().toLocaleTimeString().split(' ')[0];
        debugMessages.unshift(`[${time}] ${msg}`);
        if (debugMessages.length > 20) debugMessages.pop();
        if (debugLog) {
          debugLog.innerHTML = debugMessages.join('<br>');
        }
        console.log('[DEBUG]', msg);
      }

      // Show debug panel on mobile (triple-tap to toggle)
      if (isTouchDevice && debugPanel) {
        debugPanel.style.display = 'block';
        mobileLog('Debug enabled');
        mobileLog(`Touch: ${isTouchDevice}`);
        mobileLog(`Screen: ${window.innerWidth}x${window.innerHeight}`);

        let tapCount = 0;
        let tapTimer = null;
        document.addEventListener('touchend', (e) => {
          tapCount++;
          if (tapTimer) clearTimeout(tapTimer);
          tapTimer = setTimeout(() => {
            if (tapCount >= 3) {
              debugPanel.style.display = debugPanel.style.display === 'none' ? 'block' : 'none';
            }
            tapCount = 0;
          }, 300);
        });
      }

      // Override console.log for mobile
      const originalLog = console.log;
      console.log = function(...args) {
        originalLog.apply(console, args);
        if (isTouchDevice && debugLog) {
          mobileLog(args.map(a => typeof a === 'object' ? JSON.stringify(a) : a).join(' '));
        }
      };

      // Track touch events on mode cards
      document.addEventListener('touchstart', (e) => {
        if (e.target.closest('.mode-card')) {
          mobileLog('Touch START on mode-card');
        }
      }, { passive: true });

      document.addEventListener('touchend', (e) => {
        if (e.target.closest('.mode-card')) {
          const mode = e.target.closest('.mode-card').dataset?.mode;
          mobileLog(`Touch END on mode-card: ${mode}`);
        }
      }, { passive: true });

      document.addEventListener('click', (e) => {
        if (e.target.closest('.mode-card')) {
          const mode = e.target.closest('.mode-card').dataset?.mode;
          mobileLog(`CLICK on mode-card: ${mode}`);
        }
      }, { passive: true });

      // Log Game state changes
      setInterval(() => {
        if (typeof Game !== 'undefined' && debugLog) {
          const stateEl = document.getElementById('debugState');
          if (!stateEl) {
            const div = document.createElement('div');
            div.id = 'debugState';
            div.style.borderTop = '1px solid #0f0';
            div.style.marginTop = '4px';
            div.style.paddingTop = '4px';
            debugLog.parentNode.appendChild(div);
          }
          const st = document.getElementById('debugState');
          if (st) {
            st.innerHTML = `State: ${Game.state}<br>Player: ${Game.player ? 'OK' : 'NULL'}<br>Audio: ${AudioManager.audioUnlocked ? 'unlocked' : 'locked'}`;
          }
        }
      }, 500);

      const canvas = document.getElementById('gameCanvas');
      if (!canvas) {
        console.error('âŒ Canvas not found!');
        return;
      }

      
      console.log('ğŸ“Œ Step 1: Initialize AudioManager');
      AudioManager.init();

      
      console.log('ğŸ“Œ Step 2: Load audio files');
      AudioManager.loadSound('playerShoot', 'breakout_assets/mixkit-short-laser-gun-shot-1670.wav');
      AudioManager.loadSound('enemyShoot', 'breakout_assets/mixkit-short-laser-gun-shot-1670.wav');
      AudioManager.loadSound('explosion', 'breakout_assets/mixkit-arcade-space-shooter-dead-notification-272.wav');
      AudioManager.loadSound('hit', 'breakout_assets/mixkit-falling-hit-757.wav');
      AudioManager.loadSound('thrust', 'breakout_assets/thrust.mp3');
      AudioManager.loadSound('powerup', 'breakout_assets/mixkit-falling-hit-757.wav');
      AudioManager.loadSound('bossDeath', 'breakout_assets/mixkit-arcade-space-shooter-dead-notification-272.wav');
      AudioManager.loadSound('shieldHit', 'breakout_assets/mixkit-falling-hit-757.wav');
      AudioManager.loadSound('coinCollect', 'breakout_assets/retro-coin-4-236671.mp3');
      AudioManager.loadSound('bossEnter', 'breakout_assets/mixkit-arcade-space-shooter-dead-notification-272.wav');
      AudioManager.loadSound('gameover', 'breakout_assets/game-over-arcade-6435.mp3');
      AudioManager.loadMusic('breakout_assets/soundtrack.mp3');

      
      console.log('ğŸ“Œ Step 3: Initialize game');
      Game.init(canvas);
      UI.showMenu();

      
      console.log('ğŸ“Œ Step 4: Setup audio unlock');
      function unlockAudio() {
        console.log('ğŸ”“ User interaction detected - unlocking audio...');

        // Unlock audio on mobile first
        AudioManager.unlockAudio();

        // Then try to play music
        AudioManager.playMusic();

        // Log status after a delay
        setTimeout(() => {
          const status = AudioManager.getStatus();
          console.log('ğŸ”Š Audio status:', status);
        }, 1000);
      }

      // Listen for user interaction to unlock audio
      ['click', 'touchstart', 'keydown'].forEach(eventType => {
        document.addEventListener(eventType, unlockAudio, { once: true });
      });

      console.log('âœ… Initialization complete. Click anywhere to start audio.');

      // Show/hide mobile controls based on game state
      // isTouchDevice already declared above
      if (isTouchDevice) {
        const mobileControls = document.getElementById('mobileControls');
        setInterval(() => {
          if (Game.state === 'playing' || Game.state === 'boss') {
            mobileControls.style.display = 'block';
          } else {
            mobileControls.style.display = 'none';
          }
        }, 100);
      }

      
      // Portrait orientation hint for mobile users
      const portraitHint = document.getElementById('portraitHint');
      const portraitHintDismiss = document.getElementById('portraitHintDismiss');
      let portraitHintDismissed = false;

      function checkOrientation() {
        const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
        const isLandscape = window.innerWidth > window.innerHeight;
        const isSmallScreen = window.innerWidth < 900 || window.innerHeight < 500;

        // Show hint on mobile devices in landscape mode (unless dismissed)
        if (isTouchDevice && isLandscape && isSmallScreen && !portraitHintDismissed) {
          portraitHint.style.display = 'flex';
        } else {
          portraitHint.style.display = 'none';
        }
      }

      if (portraitHintDismiss) {
        portraitHintDismiss.addEventListener('click', () => {
          portraitHintDismissed = true;
          portraitHint.style.display = 'none';
        });
      }

      // Check orientation on load and resize
      checkOrientation();
      window.addEventListener('resize', checkOrientation);
      window.addEventListener('orientationchange', () => {
        setTimeout(checkOrientation, 100);
      });

      const muteBtn = document.getElementById('muteBtn');
      if (muteBtn) {
        muteBtn.addEventListener('click', () => {
          AudioManager.toggleMusic();
          
          muteBtn.textContent = AudioManager.music.paused ? 'ğŸ”‡' : 'ğŸ”Š';
          muteBtn.title = AudioManager.music.paused ? 'Unmute Music' : 'Mute Music';

          
          try {
            localStorage.setItem('galactic_assault_music_muted', AudioManager.music.paused ? '1' : '0');
            console.log('ğŸ”Š Music preference saved:', AudioManager.music.paused ? 'MUTED' : 'PLAYING');
          } catch (e) {
            console.warn('Could not save music preference');
          }
        });

        
        try {
          const wasMuted = localStorage.getItem('galactic_assault_music_muted') === '1';
          if (wasMuted && AudioManager.music) {
            AudioManager.music.pause();
            muteBtn.textContent = 'ğŸ”‡';
            muteBtn.title = 'Unmute Music';
            console.log('ğŸ”‡ Restored muted state from preferences');
          }
        } catch (e) {
          console.warn('Could not restore music preference');
        }
      }
    });
  </script>
</body>
</html>
