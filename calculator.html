<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Calculator</title>
    <style>
        :root{
            --bg:#0b1020; --panel:#0f172a; --panel-2:#0b1320; --text:#e5e7eb; --muted:#9ca3af;
            --accent:#38bdf8; --good:#22c55e; --warn:#f59e0b; --bad:#ef4444;
            --kbd:#111827; --btn:#1f2937; --btn-2:#111827; --shadow:0 16px 40px rgba(0,0,0,.45);
        }
        *{box-sizing:border-box}
        html,body{height:100%}
        body{
            margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, sans-serif;
            color:var(--text);
            background: radial-gradient(1200px 600px at 10% -10%, #1f2937 0%, transparent 60%), radial-gradient(1000px 500px at 110% 10%, #0b1320 0%, transparent 60%), linear-gradient(160deg, #0b1020, #0f172a 55%, #0a0f1f);
            display:grid; place-items:center; padding:18px
        }
        /* Decorative layers */
        #bgCanvas{position:fixed; inset:0; z-index:0; pointer-events:none}
        .aurora{position:fixed; inset:-20% -10% 0 -10%; z-index:0; pointer-events:none; opacity:.55; filter:blur(22px) saturate(1.1); mix-blend-mode:screen}
        .aurora::before,.aurora::after{content:""; position:absolute; border-radius:50%}
        .aurora::before{width:60vw;height:60vw;left:-10vw;top:10vh;background:radial-gradient(closest-side, rgba(59,130,246,.18), rgba(59,130,246,0) 70%);animation:aurA 22s ease-in-out infinite alternate}
        .aurora::after{width:55vw;height:55vw;right:-8vw;top:30vh;background:radial-gradient(closest-side, rgba(236,72,153,.18), rgba(236,72,153,0) 70%);animation:aurB 26s ease-in-out infinite alternate}
        @keyframes aurA{from{transform:translateY(-6vh)} to{transform:translateY(6vh)}}
        @keyframes aurB{from{transform:translateY(5vh)} to{transform:translateY(-5vh)}}
        .wrap{position:relative; max-width:1024px; width:min(100%, 980px);}
        .calc{
            display:grid; grid-template-columns: 1fr; gap:14px;
        }
        .card{position:relative; background:linear-gradient(180deg, var(--panel), var(--panel-2)); border:1px solid rgba(255,255,255,.08); border-radius:16px; box-shadow:var(--shadow); overflow:hidden}
        /* Animated glow border */
        .card::before{content:""; position:absolute; inset:-2px; background:conic-gradient(from 0deg, #38bdf8, #22c55e, #f59e0b, #ef4444, #38bdf8); filter:blur(16px); opacity:.25; z-index:0; animation:spin 20s linear infinite}
        .card > *{position:relative; z-index:1}
        @keyframes spin{to{transform:rotate(360deg)}}
        .card .header{padding:12px 14px; border-bottom:1px solid rgba(255,255,255,.08); display:flex; align-items:center; justify-content:space-between}
        .card .title{margin:0; font-size:18px}
        .card .body{padding:12px}
        .muted{color:var(--muted)}

        .screen{display:grid; gap:8px; padding:14px; background:#0e162b; border:1px solid rgba(255,255,255,.06); border-radius:12px}
        .expr{min-height:20px; color:#9fb3d9; font-size:14px; text-align:right; word-break:break-all}
        .result{min-height:44px; font-weight:800; font-size:32px; text-align:right}
        .grid{display:grid; grid-template-columns: repeat(5, 1fr); gap:10px}
        button.key{appearance:none; border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:12px; color:var(--text); background:linear-gradient(180deg, #1f2937, #111827); cursor:pointer; font-weight:700; position:relative; overflow:hidden}
        button.key:active{transform: translateY(1px)}
        button.key.op{background:linear-gradient(180deg,#38bdf8,#0ea5e9); color:#001018; border:0}
        button.key.eq{background:linear-gradient(180deg,#22c55e,#16a34a); color:#001018; border:0}
        button.key.warn{background:linear-gradient(180deg,#f59e0b,#d97706); color:#001018; border:0}
        /* Shimmer on hover */
        button.key::after{content:""; position:absolute; inset:-40% -20%; background:linear-gradient(120deg, transparent 0%, rgba(255,255,255,.15) 30%, transparent 60%); transform:translateX(-120%); transition:transform .5s ease}
        button.key:hover::after{transform:translateX(120%)}
        /* Ripple */
        .ripple{position:absolute; border-radius:50%; pointer-events:none; transform:translate(-50%,-50%); background:rgba(255,255,255,.6); mix-blend-mode:overlay; width:8px; height:8px; opacity:.8; animation:rip .6s ease-out forwards}
        @keyframes rip{to{opacity:0; transform:translate(-50%,-50%) scale(14)}}
        .row{display:flex; gap:8px; align-items:center; justify-content:space-between}
        .history{padding:10px; max-height:180px; overflow:auto; border:1px solid rgba(255,255,255,.08); border-radius:10px; background:#0e162b}
        .histItem{display:flex; justify-content:space-between; gap:8px; padding:6px 8px; border-radius:8px; cursor:pointer}
        .histItem:hover{background:rgba(255,255,255,.06)}
        .histExpr{color:#9fb3d9; font-size:12px}
        .histRes{font-weight:700}
        .kbd{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; color:#9ca3af; background:#111827; border-radius:6px; border:1px solid rgba(255,255,255,.1); padding:1px 6px}
        .foot{color:#9ca3af; font-size:12px}
        .btnIcon{appearance:none; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); color:var(--text); padding:8px 10px; border-radius:10px; cursor:pointer}
        .btnIcon:active{transform:translateY(1px)}
        @media (max-width:680px){
            .grid{grid-template-columns: repeat(4, 1fr)}
        }
    </style>
</head>
<body>
        <canvas id="bgCanvas"></canvas>
        <div class="aurora" aria-hidden="true"></div>
    <a class="homeBtn" href="index.html" aria-label="Home" style="position:fixed; left:10px; top:10px; z-index:80; display:inline-flex; align-items:center; gap:6px; padding:8px 10px; border-radius:10px; background: rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.16); color:#e5e7eb; text-decoration:none; font-weight:700; backdrop-filter: blur(6px);">üè† Home</a>
    <div class="wrap">
        <section class="card">
            <header class="header"><h1 class="title">Calculator</h1><button id="soundBtn" class="btnIcon" title="Toggle sound">üîä</button></header>
            <div class="body calc">
                <div class="screen" aria-live="polite">
                    <div id="expr" class="expr"></div>
                    <div id="res" class="result">0</div>
                </div>

                <div class="grid" id="keys">
                    <!-- Row 1 -->
                    <button class="key warn" data-action="ac">AC</button>
                    <button class="key" data-action="c">C</button>
                    <button class="key" data-action="back">‚å´</button>
                    <button class="key" data-val="%">%</button>
                    <button class="key" data-action="adv">ADV</button>
                    <!-- Row 2 -->
                    <button class="key" data-val="(">(</button>
                    <button class="key" data-val=")">)</button>
                    <button class="key" data-val="œÄ">œÄ</button>
                    <button class="key" data-val="e">e</button>
                    <button class="key" data-val="^">^</button>
                    <!-- Row 3 -->
                    <button class="key" data-val="7">7</button>
                    <button class="key" data-val="8">8</button>
                    <button class="key" data-val="9">9</button>
                    <button class="key op" data-val="√∑">√∑</button>
                    <button class="key" data-action="sqrt">‚àö</button>
                    <!-- Row 4 -->
                    <button class="key" data-val="4">4</button>
                    <button class="key" data-val="5">5</button>
                    <button class="key" data-val="6">6</button>
                    <button class="key op" data-val="√ó">√ó</button>
                    <button class="key" data-action="pow2">x¬≤</button>
                    <!-- Row 5 -->
                    <button class="key" data-val="1">1</button>
                    <button class="key" data-val="2">2</button>
                    <button class="key" data-val="3">3</button>
                    <button class="key op" data-val="-">‚àí</button>
                    <button class="key" data-action="inv">1/x</button>
                    <!-- Row 6 -->
                    <button class="key" data-val="0">0</button>
                    <button class="key" data-val=".">.</button>
                    <button class="key eq" data-action="eq">=</button>
                    <button class="key op" data-val="+">+</button>
                    <button class="key" data-action="sign">¬±</button>
                </div>

                <div id="advPanel" class="grid" style="display:none">
                    <button class="key" data-action="sin">sin</button>
                    <button class="key" data-action="cos">cos</button>
                    <button class="key" data-action="tan">tan</button>
                    <button class="key" data-action="ln">ln</button>
                    <button class="key" data-action="log">log‚ÇÅ‚ÇÄ</button>
                </div>

                <div class="row">
                    <div class="muted foot">Keys: <span class="kbd">0-9</span> <span class="kbd">+ - * /</span> <span class="kbd">( )</span> <span class="kbd">.</span> <span class="kbd">Enter</span> <span class="kbd">Backspace</span> <span class="kbd">Esc</span></div>
                </div>

                <div class="history" id="history" aria-label="History"></div>
            </div>
        </section>
    </div>

    <script>
    (function(){
        'use strict';
        const $ = s=>document.querySelector(s);
        const exprEl = $('#expr');
        const resEl = $('#res');
        const keys = $('#keys');
        const advPanel = $('#advPanel');
        const histEl = $('#history');
        const soundBtn = $('#soundBtn');

        const state = {
            expr: '',
            lastAns: 0,
            history: [] // {e, r}
        };

            // --- Sound Effects ---
            function createSFX(){
                let ctx = null, master = null; let muted = false; let unlocked = false;
                function ensure(){
                    if(!ctx){ try{ ctx = new (window.AudioContext||window.webkitAudioContext)(); }catch{} }
                    if(ctx && !master){ master = ctx.createGain(); master.gain.value = muted? 0 : 0.16; master.connect(ctx.destination); }
                }
                function unlock(){ if(ctx && ctx.state==='suspended'){ ctx.resume().catch(()=>{}); } unlocked = true; }
                function onUserGesture(){ if(!ctx) ensure(); unlock(); document.removeEventListener('pointerdown', onUserGesture); document.removeEventListener('keydown', onUserGesture); }
                document.addEventListener('pointerdown', onUserGesture, { once:false });
                document.addEventListener('keydown', onUserGesture, { once:false });

                function tone({freq=440, dur=0.12, type='sine', vol=0.25, glideTo, attack=0.005, decay=0.08}){
                    ensure(); if(!ctx||!master||muted) return;
                    const o = ctx.createOscillator(); o.type = type; o.frequency.value = freq;
                    const g = ctx.createGain(); g.gain.value = 0; g.connect(master); o.connect(g);
                    const now = ctx.currentTime;
                    g.gain.setValueAtTime(0, now);
                    g.gain.linearRampToValueAtTime(vol, now + attack);
                    g.gain.exponentialRampToValueAtTime(0.0001, now + Math.max(attack+decay, dur));
                    if(glideTo){ o.frequency.setTargetAtTime(glideTo, now, 0.03); }
                    o.start(now); o.stop(now + dur + 0.05);
                    o.onended = ()=>{ try{o.disconnect(); g.disconnect();}catch{} };
                }
                function noise({dur=0.35, vol=0.12, type='highpass'}={}){
                    ensure(); if(!ctx||!master||muted) return;
                    const buffer = ctx.createBuffer(1, Math.ceil(ctx.sampleRate*dur), ctx.sampleRate);
                    const data = buffer.getChannelData(0); for(let i=0;i<data.length;i++){ data[i] = (Math.random()*2-1) * (1 - i/data.length); }
                    const src = ctx.createBufferSource(); src.buffer = buffer;
                    const g = ctx.createGain(); g.gain.value = 0; const f = ctx.createBiquadFilter(); f.type=type; f.frequency.value=800; src.connect(f); f.connect(g); g.connect(master);
                    const now = ctx.currentTime; g.gain.setValueAtTime(0, now); g.gain.linearRampToValueAtTime(vol, now+0.04); g.gain.exponentialRampToValueAtTime(0.0001, now+dur);
                    src.start(now); src.stop(now+dur+0.02); src.onended = ()=>{ try{src.disconnect(); f.disconnect(); g.disconnect();}catch{} };
                }
                return {
                    click(){ tone({freq:640, glideTo:420, dur:0.07, type:'triangle', vol:0.18}); },
                    eq(){ tone({freq:660, glideTo:990, dur:0.18, type:'sine', vol:0.22}); },
                    error(){ tone({freq:200, glideTo:160, dur:0.14, type:'sawtooth', vol:0.16}); },
                    whoosh(){ noise({dur:0.35, vol:0.10}); },
                    toggle(){ muted = !muted; ensure(); if(master){ master.gain.value = muted? 0 : 0.16; } return !muted; }
                };
            }
            const SFX = createSFX();
            window.SFX = SFX; // allow background to trigger whoosh
            if(soundBtn){ soundBtn.addEventListener('click', ()=>{ const on = SFX.toggle(); soundBtn.textContent = on? 'üîä' : 'üîá'; }); }

        function setExpr(v){ state.expr = v; exprEl.textContent = v; }
        function setResult(v){ resEl.textContent = v; }
        function append(t){ setExpr(state.expr + t); }
        function isOp(ch){ return /[+\-*/^]/.test(ch); }
        function isDigit(ch){ return /[0-9]/.test(ch); }

        function fmt(n){
            if(!isFinite(n)) return 'Error';
            // limit long floats
            const s = Math.abs(n) < 1e-6 || Math.abs(n) >= 1e12 ? n.toExponential(8) : n.toLocaleString(undefined,{maximumFractionDigits:10});
            return s.replace(/(\.\d*?[1-9])0+$/,'$1').replace(/\.0+$/,'');
        }

        function preprocess(expr){
            // Replace symbols
            let e = expr
                .replace(/œÄ/g, 'PI')
                .replace(/e/g, 'E')
                .replace(/√ó/g, '*')
                .replace(/√∑/g, '/')
                .replace(/‚àí/g, '-')
                .replace(/\^/g, '**');

            // Percent: turn trailing number% into (number/100)
            e = e.replace(/(\d+(?:\.\d+)?)%/g, '($1/100)');

            // Functions mapping by placeholders to avoid partial matches
            e = e.replace(/sin\(/g,'Math.sin(')
                     .replace(/cos\(/g,'Math.cos(')
                     .replace(/tan\(/g,'Math.tan(')
                     .replace(/ln\(/g,'Math.log(')
                     .replace(/log\(/g,'Math.log10(')
                     .replace(/sqrt\(/g,'Math.sqrt(')
                     .replace(/PI/g,'Math.PI')
                     .replace(/E/g,'Math.E');
            return e;
        }

            function safeEval(expr){
                // Preprocess first to normalize unicode ops and symbols
                const e = preprocess(expr);
                // Allow only numbers, basic ops, parentheses, comma, percent, whitespace, dot, and letters (for Math.*)
                const allowed = /^[0-9+\-*/().,%\s^A-Za-z]*$/;
                if(!allowed.test(e)) throw new Error('bad chars');
                // Extra coarse blocklist
                if(/(?:constructor|prototype|window|document|Function)/i.test(e)) throw new Error('blocked');
                // Evaluate safely
                // eslint-disable-next-line no-new-func
                return Function('"use strict"; return ('+ e +');')();
            }

        function evaluate(){
            if(!state.expr.trim()) return;
            try{
                const val = safeEval(state.expr);
                const res = fmt(val);
                setResult(res);
                state.lastAns = val;
                state.history.unshift({e: state.expr, r: res});
                state.history = state.history.slice(0, 12);
                renderHistory();
            SFX.eq();
            }catch{
                setResult('Error');
            SFX.error();
            }
        }

        function renderHistory(){
            histEl.innerHTML = '';
            for(const h of state.history){
                const d = document.createElement('div'); d.className='histItem';
                const a = document.createElement('div'); a.className='histExpr'; a.textContent = h.e;
                const b = document.createElement('div'); b.className='histRes'; b.textContent = h.r;
                d.append(a,b);
                d.addEventListener('click', ()=>{ setExpr(h.e); setResult(h.r); });
                histEl.appendChild(d);
            }
        }

        function backspace(){ setExpr(state.expr.slice(0, -1)); }
        function clear(){ setExpr(''); }
        function allClear(){ setExpr(''); setResult('0'); }
        function toggleSign(){
            const m = state.expr.match(/(?:^|[+\-*/(])(-?\d+(?:\.\d+)?)$/);
            if(!m) return;
            const num = m[1];
            const start = m.index + (m[0].length - num.length);
            const before = state.expr.slice(0, start);
            const after = state.expr.slice(start + num.length);
            const flipped = (num[0]==='-'? num.slice(1) : '-' + num);
            setExpr(before + flipped + after);
        }
        function sqrt(){ append('sqrt('); }
        function pow2(){ append('^2'); }
        function inv(){ append('1/('); }
        function addFunc(name){ append(name + '('); }

        // Clicks
            keys.addEventListener('click', (e)=>{
            const btn = e.target.closest('button.key'); if(!btn) return;
            const val = btn.getAttribute('data-val');
            const act = btn.getAttribute('data-action');
                if(val!=null){ if(val!=='='){ SFX.click(); } append(val); return; }
            switch(act){
                case 'ac': allClear(); break;
                case 'c': clear(); break;
                case 'back': backspace(); break;
                    case 'eq': evaluate(); break;
                case 'adv': advPanel.style.display = advPanel.style.display==='none' ? '' : 'none'; break;
                case 'sqrt': sqrt(); break;
                case 'pow2': pow2(); break;
                case 'inv': inv(); break;
                case 'sign': toggleSign(); break;
                case 'sin': addFunc('sin'); break;
                case 'cos': addFunc('cos'); break;
                case 'tan': addFunc('tan'); break;
                case 'ln': addFunc('ln'); break;
                case 'log': addFunc('log'); break;
            }
        });

        // Keyboard
            document.addEventListener('keydown', (e)=>{
            const k = e.key;
                if(/^[0-9]$/.test(k)) { SFX.click(); append(k); return; }
                if(k==='.' || k==='(' || k===')') { SFX.click(); append(k); return; }
                if(k==='+'||k==='-'||k==='*'||k==='/'||k==='^') { SFX.click(); append(k); return; }
            if(k==='Enter' || k==='='){ e.preventDefault(); evaluate(); return; }
            if(k==='Backspace'){ e.preventDefault(); backspace(); return; }
            if(k==='Escape'){ e.preventDefault(); allClear(); return; }
            if(k==='%'){ append('%'); return; }
        });

            // Ripples on key click
            keys.addEventListener('pointerdown', (e)=>{
                const btn = e.target.closest('button.key'); if(!btn) return;
                const rect = btn.getBoundingClientRect();
                const x = e.clientX - rect.left; const y = e.clientY - rect.top;
                const s = document.createElement('span'); s.className='ripple'; s.style.left = x+'px'; s.style.top = y+'px';
                btn.appendChild(s); setTimeout(()=>s.remove(), 650);
            });

            // Init
        allClear();
    })();
    </script>
        <script>
            // Background stars with shooting meteors
        (function(){
            const c = document.getElementById('bgCanvas'); if(!c) return; const dpr = Math.max(1, window.devicePixelRatio||1); const ctx = c.getContext('2d');
                const stars = []; const meteors = []; let w=0,h=0; let nextMeteor = 0; 
                function resize(){ w = c.width = Math.floor(innerWidth*dpr); h = c.height = Math.floor(innerHeight*dpr); c.style.width=innerWidth+'px'; c.style.height=innerHeight+'px'; }
                function init(n=220){ stars.length=0; for(let i=0;i<n;i++){ stars.push({ x: Math.random()*w, y: Math.random()*h, r: Math.random()*1.8+0.2, a: Math.random()*Math.PI*2, s: 0.002+Math.random()*0.004 }); } }
                function spawnMeteor(){
                    // Spawn near top-left moving down-right, or top-right to down-left sometimes
                    const fromLeft = Math.random()<0.7;
                    const speed = (2 + Math.random()*3) * dpr; // px/frame
                    const angle = fromLeft? (Math.PI/4 + Math.random()*0.3) : (3*Math.PI/4 - Math.random()*0.3);
                    const vx = Math.cos(angle)*speed, vy = Math.sin(angle)*speed;
                    const x = fromLeft? -50*dpr : w + 50*dpr;
                    const y = Math.random()*0.3*h; // top 30%
                    const len = 120*dpr + Math.random()*120*dpr;
                    const ttl = 120 + Math.floor(Math.random()*80);
                    meteors.push({x,y,vx,vy,len,life:0,ttl});
                    if(window.SFX && typeof window.SFX.whoosh==='function'){ try{ window.SFX.whoosh(); }catch{} }
                }
                function drawMeteor(m){
                    const alpha = 0.8 * (1 - m.life/m.ttl);
                    ctx.globalAlpha = Math.max(0, alpha);
                    const tx = m.x - m.vx * (m.len / Math.hypot(m.vx, m.vy));
                    const ty = m.y - m.vy * (m.len / Math.hypot(m.vx, m.vy));
                    const grad = ctx.createLinearGradient(m.x, m.y, tx, ty);
                    grad.addColorStop(0, 'rgba(255,255,255,1)');
                    grad.addColorStop(1, 'rgba(255,255,255,0)');
                    ctx.strokeStyle = grad; ctx.lineWidth = Math.max(1, 1.2*dpr);
                    ctx.beginPath(); ctx.moveTo(m.x, m.y); ctx.lineTo(tx, ty); ctx.stroke();
                    ctx.globalAlpha = 1;
                }
                function step(){
                    ctx.clearRect(0,0,w,h);
                    // stars
                    ctx.fillStyle='#ffffff';
                    for(const s of stars){ s.a += s.s; const alpha = 0.35+0.35*Math.sin(s.a); ctx.globalAlpha = alpha; ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, Math.PI*2); ctx.fill(); }
                    ctx.globalAlpha=1;
                    // meteors
                    for(let i=meteors.length-1;i>=0;i--){ const m = meteors[i]; drawMeteor(m); m.x += m.vx; m.y += m.vy; m.life++; if(m.life>m.ttl || m.x<-200 || m.x>w+200 || m.y<-200 || m.y>h+200){ meteors.splice(i,1); } }
                    // schedule
                    const now = performance.now(); if(now>nextMeteor){ spawnMeteor(); nextMeteor = now + 1800 + Math.random()*2600; }
                    requestAnimationFrame(step);
                }
                resize(); init(); step(); window.addEventListener('resize', ()=>{ resize(); init(); });
        })();
        </script>
</body>
</html>
