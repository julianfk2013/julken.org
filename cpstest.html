<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CPS Test</title>
  <style>
    :root{
      --bg:#0b1020; --panel:#0f172a; --panel-2:#0b1320; --text:#e5e7eb; --muted:#9ca3af;
      --accent:#38bdf8; --good:#22c55e; --warn:#f59e0b; --bad:#ef4444; --shadow:0 16px 40px rgba(0,0,0,.45);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, sans-serif; color:var(--text);
      background: radial-gradient(1200px 600px at 10% -10%, #1f2937 0%, transparent 60%), radial-gradient(1000px 500px at 110% 10%, #0b1320 0%, transparent 60%), linear-gradient(160deg, #0b1020, #0f172a 55%, #0a0f1f);
      display:grid; place-items:center; overflow:hidden; padding:16px
    }
    #bgCanvas{position:fixed; inset:0; z-index:0; pointer-events:none}
    .aurora{position:fixed; inset:-20% -10% 0 -10%; z-index:0; pointer-events:none; opacity:.55; filter:blur(22px) saturate(1.1); mix-blend-mode:screen}
    .aurora::before,.aurora::after{content:""; position:absolute; border-radius:50%}
    .aurora::before{width:60vw;height:60vw;left:-10vw;top:10vh;background:radial-gradient(closest-side, rgba(59,130,246,.18), rgba(59,130,246,0) 70%);animation:aurA 22s ease-in-out infinite alternate}
    .aurora::after{width:55vw;height:55vw;right:-8vw;top:30vh;background:radial-gradient(closest-side, rgba(236,72,153,.18), rgba(236,72,153,0) 70%);animation:aurB 26s ease-in-out infinite alternate}
    @keyframes aurA{from{transform:translateY(-6vh)} to{transform:translateY(6vh)}}
    @keyframes aurB{from{transform:translateY(5vh)} to{transform:translateY(-5vh)}}

    .card{position:relative; z-index:1; width:min(100%, 960px); background:linear-gradient(180deg, var(--panel), var(--panel-2)); border:1px solid rgba(255,255,255,.08); border-radius:16px; box-shadow:var(--shadow); overflow:hidden}
    .card::before{content:""; position:absolute; inset:-2px; background:conic-gradient(from 0deg, #38bdf8, #22c55e, #f59e0b, #ef4444, #38bdf8); filter:blur(16px); opacity:.25; z-index:0; animation:spin 20s linear infinite}
    .card>*{position:relative; z-index:1}
    @keyframes spin{to{transform:rotate(360deg)}}
    .header{display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid rgba(255,255,255,.08)}
    .title{margin:0; font-size:22px}
    .btnIcon{appearance:none; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); color:var(--text); padding:8px 10px; border-radius:10px; cursor:pointer}
    .btnIcon:active{transform:translateY(1px)}
    .body{padding:16px; display:grid; gap:14px}

    .controls{display:flex; flex-wrap:wrap; gap:8px}
    .btn{appearance:none; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.06); color:var(--text); padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600}
    .btn.primary{background:linear-gradient(180deg,#38bdf8,#0ea5e9); color:#001018; border:0}
    .btn.warn{background:linear-gradient(180deg,#f59e0b,#d97706); color:#001018; border:0}

    .stats{display:grid; grid-template-columns: repeat(4, 1fr); gap:10px}
    .stat{background:#0e162b; border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:10px 12px}
    .lab{color:#9ca3af; font-size:12px}
    .val{font-size:22px; font-weight:800}

    .targetWrap{display:grid; gap:10px; place-items:center}
    .target{user-select:none; width:min(90vw, 520px); height:180px; display:grid; place-items:center; border-radius:16px; border:1px solid rgba(255,255,255,.08); background:linear-gradient(180deg,#1f2937,#111827); color:#e5e7eb; font-size: clamp(20px, 4vw, 34px); font-weight:800; letter-spacing:.5px; cursor:pointer; transition: transform .06s ease; position:relative; overflow:hidden}
    .target:active{transform:scale(.99)}
    .ripple{position:absolute; border-radius:50%; pointer-events:none; transform:translate(-50%,-50%); background:rgba(255,255,255,.6); mix-blend-mode:overlay; width:12px; height:12px; opacity:.8; animation:rip .6s ease-out forwards}
    @keyframes rip{to{opacity:0; transform:translate(-50%,-50%) scale(16)}}
    .overlay{position:absolute; inset:0; display:grid; place-items:center; background:rgba(0,0,0,.35); font-size: clamp(32px, 8vw, 64px); font-weight:900; letter-spacing:1px; text-shadow:0 8px 24px rgba(0,0,0,.45);}
    .hidden{display:none}

    .resultBox{background:#0e162b; border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:12px}
    .muted{color:#9ca3af}
    @media (max-width:720px){ .stats{grid-template-columns: repeat(2, 1fr)} }

  /* Modal overlay */
  .modal{position:fixed; inset:0; z-index:50; display:none; place-items:center; background:rgba(0,0,0,.45); backdrop-filter: blur(8px)}
  .modal.show{display:grid}
  .modalBox{width:min(92vw, 640px); background:linear-gradient(180deg, var(--panel), var(--panel-2)); border:1px solid rgba(255,255,255,.12); border-radius:16px; box-shadow:var(--shadow); padding:16px}
  .modalTitle{margin:0 0 8px 0; font-size:22px; font-weight:800}
  .modalContent{color:#cbd5e1; line-height:1.5; margin-bottom:12px}
  .modalActions{display:flex; gap:8px; justify-content:flex-end}
  .animalImg{display:block; width:160px; height:160px; object-fit:contain; margin:6px auto 12px auto; filter: drop-shadow(0 8px 24px rgba(0,0,0,.4))}
  </style>
</head>
<body>
  <canvas id="bgCanvas"></canvas>
  <div class="aurora" aria-hidden="true"></div>
  <a class="homeBtn" href="index.html" aria-label="Home" style="position:fixed; left:10px; top:10px; z-index:80; display:inline-flex; align-items:center; gap:6px; padding:8px 10px; border-radius:10px; background: rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.16); color:#e5e7eb; text-decoration:none; font-weight:700; backdrop-filter: blur(6px);">üè† Home</a>
  <section class="card">
    <div class="header">
      <h1 class="title">CPS Test</h1>
      <button id="soundBtn" class="btnIcon" title="Toggle sound">üîä</button>
    </div>
    <div class="body">
      <div class="controls">
        <button class="btn" data-mode="1">1s</button>
        <button class="btn" data-mode="5">5s</button>
        <button class="btn" data-mode="10">10s</button>
        <button class="btn" data-mode="15">15s</button>
        <button class="btn" data-mode="30">30s</button>
        <button class="btn" data-mode="60">60s</button>
        <input id="customTime" type="number" min="1" max="300" placeholder="Custom (s)" class="btn" style="width:120px" />
        <button id="startBtn" class="btn primary">Start</button>
        <button id="resetBtn" class="btn warn">Reset</button>
      </div>

      <div class="stats">
        <div class="stat"><div class="lab">Time Left</div><div id="timeLeft" class="val">0.0s</div></div>
        <div class="stat"><div class="lab">Clicks</div><div id="clicks" class="val">0</div></div>
        <div class="stat"><div class="lab">CPS</div><div id="cps" class="val">0.00</div></div>
        <div class="stat"><div class="lab">Best (All-Time)</div><div id="best" class="val">0.00</div></div>
      </div>

      <div class="targetWrap">
        <div id="target" class="target" role="button" aria-label="Click as fast as you can">
          <span id="targetText">Click to start</span>
          <div id="countdown" class="overlay hidden">3</div>
        </div>
        <div id="result" class="resultBox muted">Pick a duration and press Start, or just click the box.</div>
      </div>
    </div>
  </section>

  <!-- Results Modal -->
  <div id="modal" class="modal" aria-modal="true" role="dialog" aria-labelledby="modalTitle">
    <div class="modalBox">
      <h2 id="modalTitle" class="modalTitle">Results</h2>
      <div id="modalContent" class="modalContent"></div>
      <div class="modalActions">
        <button id="modalRestart" class="btn primary">Try Again</button>
        <button id="modalClose" class="btn">Close</button>
      </div>
    </div>
  </div>

  <script>
  (function(){
    'use strict';
    const $ = s=>document.querySelector(s);
    const target = $('#target');
    const targetText = $('#targetText');
    const countdownEl = $('#countdown');
    const startBtn = $('#startBtn');
    const resetBtn = $('#resetBtn');
    const soundBtn = $('#soundBtn');
    const customTime = $('#customTime');
    const timeLeft = $('#timeLeft');
    const clicksEl = $('#clicks');
    const cpsEl = $('#cps');
    const bestEl = $('#best');
    const resultEl = $('#result');
    const modeBtns = Array.from(document.querySelectorAll('[data-mode]'));
  const modal = $('#modal');
  const modalContent = $('#modalContent');
  const modalClose = $('#modalClose');
  const modalRestart = $('#modalRestart');

    const store = {
      get(k,d){ try{ const v=localStorage.getItem(k); return v? JSON.parse(v): d; }catch{ return d; } },
      set(k,v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch{} }
    };

    // SFX
    function createSFX(){
      let ctx=null, gain=null, muted=false;
      function ensure(){ if(!ctx){ try{ ctx=new (window.AudioContext||window.webkitAudioContext)(); }catch{} } if(ctx && !gain){ gain=ctx.createGain(); gain.gain.value = muted?0:0.16; gain.connect(ctx.destination);} }
      function unlock(){ if(ctx && ctx.state==='suspended'){ ctx.resume().catch(()=>{}); } }
      function click(){ ensure(); if(!ctx||!gain||muted) return; const o=ctx.createOscillator(); o.type='triangle'; o.frequency.value=520; const g=ctx.createGain(); g.gain.value=0; const now=ctx.currentTime; g.gain.setValueAtTime(0,now); g.gain.linearRampToValueAtTime(0.18, now+0.01); g.gain.exponentialRampToValueAtTime(0.0001, now+0.12); o.connect(g); g.connect(gain); o.start(); o.stop(now+0.14); o.onended=()=>{try{o.disconnect(); g.disconnect();}catch{}} }
      function done(){ ensure(); if(!ctx||!gain||muted) return; const o=ctx.createOscillator(); o.type='sine'; o.frequency.setValueAtTime(560, ctx.currentTime); o.frequency.linearRampToValueAtTime(880, ctx.currentTime+0.18); const g=ctx.createGain(); g.gain.value=0; const now=ctx.currentTime; g.gain.setValueAtTime(0,now); g.gain.linearRampToValueAtTime(0.22, now+0.02); g.gain.exponentialRampToValueAtTime(0.0001, now+0.3); o.connect(g); g.connect(gain); o.start(); o.stop(now+0.32); }
      function error(){ ensure(); if(!ctx||!gain||muted) return; const o=ctx.createOscillator(); o.type='sawtooth'; o.frequency.value=200; const g=ctx.createGain(); g.gain.value=0; const now=ctx.currentTime; g.gain.setValueAtTime(0,now); g.gain.linearRampToValueAtTime(0.16, now+0.01); g.gain.exponentialRampToValueAtTime(0.0001, now+0.18); o.connect(g); g.connect(gain); o.start(); o.stop(now+0.2); }
      function toggle(){ muted=!muted; ensure(); if(gain){ gain.gain.value = muted? 0 : 0.16; } return !muted; }
      document.addEventListener('pointerdown', unlock, { once:false }); document.addEventListener('keydown', unlock, { once:false });
      return { click, done, error, toggle };
    }
    const SFX = createSFX();
    soundBtn.addEventListener('click', ()=>{ const on = SFX.toggle(); soundBtn.textContent = on? 'üîä' : 'üîá'; });

    let duration = 5; // seconds
    let running = false; let countingDown = false;
    let startTs = 0; let clicks = 0; let rafId = 0;
    const best = store.get('cps_best', { all: 0 });

    function fmt(n){ return Number(n).toFixed(2); }

    function updateBest(cps){ if(!isFinite(cps)) return; if(cps> (best.all||0)){ best.all = cps; store.set('cps_best', best); } bestEl.textContent = fmt(best.all||0); }

    function setMode(sec){ duration = Math.max(1, Math.min(300, Math.floor(sec||5))); modeBtns.forEach(b=> b.classList.toggle('primary', Number(b.dataset.mode)===duration)); }
    modeBtns.forEach(b=> b.addEventListener('click', ()=>{ setMode(Number(b.dataset.mode)); }));
    setMode(5);

  function reset(){ running=false; countingDown=false; cancelAnimationFrame(rafId); clicks=0; clicksEl.textContent = '0'; cpsEl.textContent='0.00'; timeLeft.textContent = '0.0s'; targetText.textContent='Click to start'; countdownEl.classList.add('hidden'); resultEl.textContent = 'Pick a duration and press Start, or just click the box.'; resultEl.classList.add('muted'); if(modal) modal.classList.remove('show'); }
    resetBtn.addEventListener('click', reset);

    function preCountdown(cb){ if(countingDown||running) return; countingDown=true; let n=3; countdownEl.textContent = n; countdownEl.classList.remove('hidden'); const tick=()=>{ if(n<=1){ countdownEl.classList.add('hidden'); countingDown=false; cb(); } else { n--; countdownEl.textContent = n; setTimeout(tick, 1000); } }; setTimeout(tick, 1000); }

    function start(){ if(running||countingDown) return; // apply custom time if given
      const custom = Number(customTime.value); if(custom && custom>0){ setMode(custom); }
      clicks=0; clicksEl.textContent='0'; resultEl.textContent='Go!'; resultEl.classList.remove('muted'); preCountdown(()=>{ running=true; startTs=performance.now(); loop(); }); }
    startBtn.addEventListener('click', start);

    function loop(){ if(!running) return; const now = performance.now(); const elapsed = (now - startTs)/1000; const remain = Math.max(0, duration - elapsed); const cps = clicks / Math.max(0.001, elapsed); timeLeft.textContent = remain.toFixed(1)+'s'; cpsEl.textContent = fmt(cps); if(remain<=0){ finish(); return; } rafId = requestAnimationFrame(loop); }

    function finish(){
      running=false; cancelAnimationFrame(rafId);
      const total = duration; const cps = clicks / total; const animal = getAnimal(cps);
      resultEl.innerHTML = `<b>Result:</b> ${clicks} clicks in ${total}s ‚Üí <b>${fmt(cps)} CPS</b> ‚Äî ${animal}`;
      updateBest(cps);
      SFX.done();
      // Show modal overlay
      if(modal && modalContent){
        const imgFile = (function(){
          const m = { turtle:'turtle.png', rabbit:'rabbit.png', leopard:'Leopard.png', falcon:'falcon.png', flash:'flash.png' };
          const key = String(animal||'').toLowerCase(); return m[key]||null;
        })();
        const imgTag = imgFile ? `<img class="animalImg" src="cps_assets/${imgFile}" alt="${animal}">` : '';
        modalContent.innerHTML = `${imgTag}
          <div style="font-size:18px; margin-bottom:8px"><b>${fmt(cps)} CPS</b> ‚Äî ${animal}</div>
          <div class="muted">You made <b>${clicks}</b> clicks in <b>${total}</b> second${total===1?'':'s'}.</div>
          <div class="muted" style="margin-top:8px">Best all-time: <b>${fmt((JSON.parse(localStorage.getItem('cps_best')||'{\"all\":0}').all)||0)}</b> CPS</div>`;
        modal.classList.add('show');
      }
    }

    // Modal actions
    if(modalClose){ modalClose.addEventListener('click', ()=>{ modal.classList.remove('show'); }); }
    if(modalRestart){ modalRestart.addEventListener('click', ()=>{ modal.classList.remove('show'); start(); }); }

    function clickTarget(ev){ const rect=target.getBoundingClientRect(); const x=ev.clientX-rect.left, y=ev.clientY-rect.top; const r=document.createElement('span'); r.className='ripple'; r.style.left=x+'px'; r.style.top=y+'px'; target.appendChild(r); setTimeout(()=>r.remove(), 650); if(!running&&!countingDown){ start(); return; } if(!running) return; clicks++; clicksEl.textContent = String(clicks); SFX.click(); }
    target.addEventListener('pointerdown', clickTarget);

    function getAnimal(cps){
      if(cps < 3) return 'Turtle';      // very slow
      else if(cps < 6) return 'Rabbit'; // casual
      else if(cps < 9) return 'Leopard';// fast
      else if(cps < 12) return 'Falcon';// very fast
      else return 'Flash';              // insane
    }

    // Init
    bestEl.textContent = fmt(best.all||0);
  })();
  </script>

  <script>
  // Background stars with shooting meteors
  (function(){
    const c = document.getElementById('bgCanvas'); if(!c) return; const dpr = Math.max(1, window.devicePixelRatio||1); const ctx = c.getContext('2d');
    const stars = []; const meteors = []; let w=0,h=0; let nextMeteor=0;
    function resize(){ w = c.width = Math.floor(innerWidth*dpr); h = c.height = Math.floor(innerHeight*dpr); c.style.width=innerWidth+'px'; c.style.height=innerHeight+'px'; }
    function init(n=220){ stars.length=0; for(let i=0;i<n;i++){ stars.push({ x: Math.random()*w, y: Math.random()*h, r: Math.random()*1.8+0.2, a: Math.random()*Math.PI*2, s: 0.002+Math.random()*0.004 }); } }
    function spawnMeteor(){ const fromLeft = Math.random()<0.7; const speed=(2+Math.random()*3)*dpr; const angle = fromLeft? (Math.PI/4+Math.random()*0.3):(3*Math.PI/4-Math.random()*0.3); const vx=Math.cos(angle)*speed, vy=Math.sin(angle)*speed; const x = fromLeft? -50*dpr : w+50*dpr; const y = Math.random()*0.3*h; const len=120*dpr+Math.random()*120*dpr; const ttl=120+Math.floor(Math.random()*80); meteors.push({x,y,vx,vy,len,life:0,ttl}); }
    function drawMeteor(m){ const alpha=0.8*(1-m.life/m.ttl); ctx.globalAlpha=Math.max(0,alpha); const hyp=Math.hypot(m.vx,m.vy); const tx = m.x - m.vx*(m.len/hyp); const ty = m.y - m.vy*(m.len/hyp); const grad=ctx.createLinearGradient(m.x,m.y,tx,ty); grad.addColorStop(0,'rgba(255,255,255,1)'); grad.addColorStop(1,'rgba(255,255,255,0)'); ctx.strokeStyle=grad; ctx.lineWidth=Math.max(1,1.2*dpr); ctx.beginPath(); ctx.moveTo(m.x,m.y); ctx.lineTo(tx,ty); ctx.stroke(); ctx.globalAlpha=1; }
    function step(){ ctx.clearRect(0,0,w,h); ctx.fillStyle='#ffffff'; for(const s of stars){ s.a += s.s; const alpha = 0.35+0.35*Math.sin(s.a); ctx.globalAlpha=alpha; ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill(); } ctx.globalAlpha=1; for(let i=meteors.length-1;i>=0;i--){ const m=meteors[i]; drawMeteor(m); m.x+=m.vx; m.y+=m.vy; m.life++; if(m.life>m.ttl||m.x<-200||m.x>w+200||m.y<-200||m.y>h+200){ meteors.splice(i,1); } } const now=performance.now(); if(now>nextMeteor){ spawnMeteor(); nextMeteor = now + 1800 + Math.random()*2600; } requestAnimationFrame(step); }
    resize(); init(); step(); window.addEventListener('resize', ()=>{ resize(); init(); });
  })();
  </script>
</body>
</html>